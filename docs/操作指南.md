# åŒ»å­¦æŒ‡æ ‡è®¡ç®—ç³»ç»Ÿæ“ä½œæŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

åŒ»å­¦æŒ‡æ ‡è®¡ç®—ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„è‡ªåŠ¨åŒ–åŒ»å­¦æŒ‡æ ‡è®¡ç®—å’Œè¯„ä¼°ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿèƒ½å¤Ÿä»ç”µå­ç—…å†ä¸­è‡ªåŠ¨æå–ç›¸å…³ä¿¡æ¯ï¼Œå¹¶è®¡ç®—å„ç§åŒ»å­¦è´¨æ§æŒ‡æ ‡ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

#### ç›®å½•ç»“æ„
```
text2rule/
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py
â”œâ”€â”€ core/                   # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ utils.py
â”‚   â”œâ”€â”€ llm_client.py
â”‚   â”œâ”€â”€ data_loader.py
â”‚   â””â”€â”€ function_executor.py
â”œâ”€â”€ executor/               # æ‰§è¡Œå™¨æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ main_executor.py
â”œâ”€â”€ web/                    # Webç•Œé¢
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ gradio_app.py
â”œâ”€â”€ data/                   # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ generated_functions/
â”‚   â”œâ”€â”€ patient_data/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ results/                # ç»“æœç›®å½•
â”‚   â””â”€â”€ execution_results/
â”œâ”€â”€ logs/                   # æ—¥å¿—ç›®å½•
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â””â”€â”€ requirements.txt
```

### 2. è¿è¡Œæ–¹å¼

#### Webç•Œé¢æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
python main.py --mode web
```
ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:7860`

#### å‘½ä»¤è¡Œæ¨¡å¼
```bash
python main.py --mode cli --api-key YOUR_API_KEY --base-url YOUR_BASE_URL --task-type cmqcic
```

## ğŸ”§ é…ç½®è¯´æ˜

### APIé…ç½®

ç³»ç»Ÿæ”¯æŒä¸¤ç§LLMæä¾›å•†ï¼š

#### OpenAIé…ç½®
```python
OPENAI_CONFIG = {
    "key": "your-openai-api-key",
    "base_url": "https://api.openai.com/v1",
    "extraction_model": "gpt-4o-mini-2024-07-18",
    "conversion_model": "gpt-4o-mini-2024-07-18"
}
```

#### Qwené…ç½®
```python
QWEN_CONFIG = {
    "key": "your-qwen-api-key",
    "base_url": "your-qwen-base-url",
    "extraction_model": "qwen2.5-72b-instruct",
    "conversion_model": "qwen2.5-72b-instruct"
}
```

### ä»»åŠ¡é…ç½®

ç³»ç»Ÿæ”¯æŒä¸¤ç§ä»»åŠ¡ç±»å‹ï¼š

#### CMCICä»»åŠ¡
- æ–‡ä»¶ï¼š`data/data.jsonl`
- IDå­—æ®µï¼š`unique_id`
- ç—…å†å­—æ®µï¼š`patient note`

#### MedCalcä»»åŠ¡
- æ–‡ä»¶ï¼š`data/MedCalc_test_data.jsonl`
- IDå­—æ®µï¼š`Calculator ID`
- ç—…å†å­—æ®µï¼š`Patient Note`

## ğŸ“Š ä½¿ç”¨æµç¨‹

### 1. Webç•Œé¢ä½¿ç”¨

#### ç³»ç»Ÿé…ç½®
1. æ‰“å¼€Webç•Œé¢
2. åœ¨"ç³»ç»Ÿé…ç½®"æ ‡ç­¾é¡µä¸­è¾“å…¥APIé…ç½®
3. é€‰æ‹©æ¨¡å‹æä¾›å•†ï¼ˆOpenAIæˆ–Qwenï¼‰
4. ç‚¹å‡»"æµ‹è¯•è¿æ¥"éªŒè¯é…ç½®
5. é€‰æ‹©ä»»åŠ¡ç±»å‹å¹¶åŠ è½½ä»»åŠ¡åˆ—è¡¨

#### ä»»åŠ¡æ‰§è¡Œ
1. åˆ‡æ¢åˆ°"ä»»åŠ¡æ‰§è¡Œ"æ ‡ç­¾é¡µ
2. ç‚¹å‡»"å¼€å§‹æ‰§è¡Œ"è¿›è¡Œæ‰¹é‡å¤„ç†
3. æŸ¥çœ‹æ‰§è¡Œè¿›åº¦å’ŒçŠ¶æ€

#### å•ä»»åŠ¡æµ‹è¯•
1. åˆ‡æ¢åˆ°"å•ä»»åŠ¡æµ‹è¯•"æ ‡ç­¾é¡µ
2. é€‰æ‹©è¦æµ‹è¯•çš„ä»»åŠ¡
3. è¾“å…¥æ‚£è€…ç—…å†å†…å®¹
4. ç‚¹å‡»"æµ‹è¯•ä»»åŠ¡"æŸ¥çœ‹ç»“æœ

#### ç»“æœæŸ¥çœ‹
1. åˆ‡æ¢åˆ°"ç»“æœæŸ¥çœ‹"æ ‡ç­¾é¡µ
2. é€‰æ‹©ç»“æœæ–‡ä»¶
3. ç‚¹å‡»"åŠ è½½ç»“æœ"æŸ¥çœ‹æ•°æ®

### 2. å‘½ä»¤è¡Œä½¿ç”¨

#### åŸºæœ¬ç”¨æ³•
```bash
python main.py --mode cli \
    --api-key YOUR_API_KEY \
    --base-url YOUR_BASE_URL \
    --provider openai \
    --task-type cmqcic
```

#### é«˜çº§ç”¨æ³•
```bash
python main.py --mode cli \
    --api-key YOUR_API_KEY \
    --base-url YOUR_BASE_URL \
    --provider qwen \
    --task-type medcalc \
    --include-ids task1 task2 task3 \
    --output-file results/custom_results.jsonl
```

## ğŸ“ æ•°æ®æ ¼å¼

### ç”Ÿæˆå‡½æ•°æ–‡ä»¶æ ¼å¼
```json
{
    "task_index": "ä»»åŠ¡ID",
    "python_code": "def calculate_indicator(...): ...",
    "properties": {
        "row": "{\"property1\": \"type1\", \"property2\": \"type2\"}"
    },
    "need_unit": {
        "property1": "unit1",
        "property2": "unit2"
    }
}
```

### æ‚£è€…æ•°æ®æ–‡ä»¶æ ¼å¼
```json
{
    "unique_id": "æ‚£è€…ID",
    "patient note": "æ‚£è€…ç—…å†å†…å®¹..."
}
```

### ç»“æœæ–‡ä»¶æ ¼å¼
```json
{
    "id": "ä»»åŠ¡ID",
    "results": [
        {
            "extract_para": {"param1": "value1"},
            "result": 0.85
        }
    ]
}
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. APIè¿æ¥å¤±è´¥
- æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥Base URLæ˜¯å¦å¯è®¿é—®
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

#### 2. ä»»åŠ¡æ‰§è¡Œå¤±è´¥
- æ£€æŸ¥æ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- ç¡®è®¤æ–‡ä»¶æ ¼å¼æ­£ç¡®
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

#### 3. å†…å­˜ä¸è¶³
- å‡å°‘å¹¶å‘ä»»åŠ¡æ•°é‡
- åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®
- å¢åŠ ç³»ç»Ÿå†…å­˜

### æ—¥å¿—æŸ¥çœ‹
æ—¥å¿—æ–‡ä»¶ä½äº `logs/` ç›®å½•ä¸‹ï¼ŒåŒ…å«è¯¦ç»†çš„æ‰§è¡Œä¿¡æ¯å’Œé”™è¯¯ä¿¡æ¯ã€‚

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„LLMæä¾›å•†
1. åœ¨ `config/settings.py` ä¸­æ·»åŠ æ–°çš„é…ç½®
2. åœ¨ `core/llm_client.py` ä¸­å®ç°ç›¸åº”çš„å®¢æˆ·ç«¯
3. æ›´æ–°Webç•Œé¢ä¸­çš„æä¾›å•†é€‰é¡¹

### æ·»åŠ æ–°çš„ä»»åŠ¡ç±»å‹
1. åœ¨ `config/settings.py` ä¸­æ·»åŠ ä»»åŠ¡é…ç½®
2. å‡†å¤‡ç›¸åº”çš„æ•°æ®æ–‡ä»¶
3. æ›´æ–°Webç•Œé¢ä¸­çš„ä»»åŠ¡ç±»å‹é€‰é¡¹

### è‡ªå®šä¹‰æç¤ºè¯
åœ¨ `config/settings.py` çš„ `PromptConfig` ç±»ä¸­ä¿®æ”¹ç›¸åº”çš„æç¤ºè¯ã€‚

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤æ•°æ®æ–‡ä»¶æ ¼å¼æ˜¯å¦ç¬¦åˆè¦æ±‚
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚ 